{% extends "travel/base.html" %}
{% load static %}
{% load humanize %}

<!-- Memuat humanize untuk memformat angka dengan koma/titik,
pastikan 'django.contrib.humanize' ada di settings.py -->

{% block title %}Detail: {{ perjalanan.tujuan }}{% endblock %}

{% block content %}

<div class="container mx-auto px-4 py-10">

<!-- Bagian Detail Utama dan Sidebar -->
<div class="lg:flex lg:space-x-10">

    <!-- Konten Utama (Deskripsi dan Ulasan) -->
    <div class="lg:w-2/3 space-y-10">
        <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
            
            <!-- Header Perjalanan -->
            <h1 class="text-4xl font-extrabold text-indigo-800 mb-2">{{ perjalanan.tujuan }}</h1>
            <p class="text-xl text-gray-600 mb-6 border-b pb-4">
                Keberangkatan: {{ perjalanan.tgl_berangkat|date:"d F Y" }}
            </p>

            <!-- Placeholder Gambar -->
            <img src="https://placehold.co/1000x500/312E81/F5F5F5?text=Destinasi+{{ perjalanan.tujuan }}" 
                 alt="Gambar Utama {{ perjalanan.tujuan }}" 
                 class="w-full h-80 object-cover rounded-xl mb-6 shadow-md">
            
            <!-- Deskripsi Lengkap -->
            <h2 class="text-2xl font-semibold text-gray-800 mb-3 border-b pb-2">Deskripsi Lengkap</h2>
            <div class="prose max-w-none text-gray-700 leading-relaxed">
                {{ perjalanan.deskripsi|linebreaks }}
            </div>
        </div>

        <!-- Bagian Ulasan (Reviews) -->
        <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-100">
            <div class="flex justify-between items-center mb-6 border-b pb-3">
                <h2 class="text-2xl font-semibold text-gray-800">Ulasan Pelanggan ({{ ulasan|length }})</h2>
                <a href="{% url 'travel_web:tambah_ulasan' perjalanan_id=perjalanan.pk %}" 
                   class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 transition duration-150">
                    + Tulis Ulasan
                </a>
            </div>

            {% if ulasan %}
                <div class="space-y-6">
                    {% for ulasan_item in ulasan %}
                    <div class="p-4 border-l-4 border-indigo-200 bg-indigo-50 rounded-r-lg">
                        <div class="flex justify-between items-center mb-1">
                            <span class="font-bold text-indigo-700">{{ ulasan_item.nama_reviewer }}</span>
                            <!-- Tampilkan rating bintang jika ada, atau nilai angka -->
                            <span class="text-sm font-medium text-yellow-600">
                                Rating: {{ ulasan_item.rating }}/5
                            </span>
                        </div>
                        <p class="text-gray-700 italic text-sm mb-2">
                            "{{ ulasan_item.komentar|linebreaksbr }}"
                        </p>
                        <span class="text-xs text-gray-500 block text-right">
                            Dibuat pada: {{ ulasan_item.tgl_dibuat|date:"d M Y" }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center p-6 border border-dashed border-gray-300 rounded-lg">
                    <p class="text-gray-500">Belum ada ulasan untuk perjalanan ini.</p>
                    <a href="{% url 'travel_web:tambah_ulasan' perjalanan_id=perjalanan.pk %}" 
                       class="text-indigo-600 hover:text-indigo-800 text-sm mt-2 block font-medium">
                        Jadilah yang pertama memberikan ulasan!
                    </a>
                </div>
            {% endif %}
        </div>
    </div>
    
    <!-- Sidebar (Ringkasan & Tombol Pesan) -->
    <div class="lg:w-1/3 mt-10 lg:mt-0">
        <div class="sticky top-10 bg-indigo-50 p-6 rounded-xl shadow-xl border border-indigo-100">
            
            <h3 class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2">Ringkasan & Pemesanan</h3>
            
            <div class="space-y-4 mb-6">
                <div class="flex justify-between items-center">
                    <span class="text-gray-700 font-medium">Harga per Orang:</span>
                    <span class="text-2xl font-extrabold text-green-600">
                        Rp {{ perjalanan.harga|floatformat:0|intcomma }}
                    </span>
                </div>
                
                <div class="flex justify-between items-center border-t pt-3">
                    <span class="text-gray-700 font-medium">Durasi:</span>
                    <span class="text-lg font-bold text-indigo-500">
                        {{ perjalanan.durasi }} Hari
                    </span>
                </div>

                <div class="flex justify-between items-center">
                    <span class="text-gray-700 font-medium">Tanggal Berangkat:</span>
                    <span class="text-lg font-bold text-indigo-500">
                        {{ perjalanan.tgl_berangkat|date:"d M Y" }}
                    </span>
                </div>

                <div class="flex justify-between items-center">
                    <span class="text-gray-700 font-medium">Maks. Peserta:</span>
                    <span class="text-lg font-bold text-indigo-500">
                        {{ perjalanan.kapasitas }} Orang
                    </span>
                </div>
            </div>

            <!-- Tombol Pemesanan -->
            <a href="{% url 'travel_web:pemesanan_form' perjalanan_id=perjalanan.pk %}" 
               class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-lg text-lg font-medium text-white bg-pink-600 hover:bg-pink-700 focus:outline-none focus:ring-4 focus:ring-offset-2 focus:ring-pink-500 transition duration-150 transform hover:scale-[1.02]">
                Pesan Sekarang!
            </a>
            
        </div>
    </div>

</div>
<!-- End Detail Utama dan Sidebar -->


</div>
{% endblock content %}